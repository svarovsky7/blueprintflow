# Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ ÑÑ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚Ð¾Ð² Ð¸ Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³Ð°

## ðŸ› **ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹:**
1. ÐÐ° ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð° Ð½Ðµ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°Ð»Ð¸ÑÑŒ ÑÑ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚Ñ‹ Ð¸ Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸
2. Ð’ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ðµ `block_connections_mapping` Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ñ Ð½Ð°Ð·Ñ‹Ð²Ð°Ð»Ð¸ÑÑŒ "ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ" Ð²Ð¼ÐµÑÑ‚Ð¾ "ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³"

## âœ… **Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ñ:**

### 1. Ð£Ð½Ð¸Ñ„Ð¸ÐºÐ°Ñ†Ð¸Ñ Ñ‚Ð¸Ð¿Ð¾Ð² ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹
**Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð° "ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ" â†’ "ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³":**

**Ð’ ÐºÐ¾Ð´Ðµ (`Projects.tsx`):**
```typescript
// Ð‘Ñ‹Ð»Ð¾
'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ'

// Ð¡Ñ‚Ð°Ð»Ð¾
'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³'
```

**Ð’ Ñ‚Ð¸Ð¿Ð°Ñ… (`types.ts` Ð¸ `projects-api.ts`):**
```typescript
// Ð‘Ñ‹Ð»Ð¾
connection_type: 'Ð¡Ñ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚' | 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ' | 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³'

// Ð¡Ñ‚Ð°Ð»Ð¾
connection_type: 'Ð¡Ñ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚' | 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³'
```

**Ð›Ð¾Ð³Ð¸ÐºÐ° Ñ€Ð°Ð·Ð»Ð¸Ñ‡ÐµÐ½Ð¸Ñ:**
- **`to_block_id !== null`** - Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸
- **`to_block_id === null`** - Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³ Ð¿Ð¾Ð´ Ð¾Ð´Ð½Ð¸Ð¼ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ¾Ð¼

### 2. Ð˜ÑÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð´Ð°Ð½Ð½Ñ‹Ñ…
**Ð’ `loadProjectCardData()` Ð² `Projects.tsx`:**
```typescript
// Ð Ð°Ð·Ð»Ð¸Ñ‡Ð°ÐµÐ¼ Ð´Ð²Ð° Ñ‚Ð¸Ð¿Ð° Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³Ð°
const undergroundConnections = connections?.filter(c =>
  c.connection_type === 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³' && c.to_block_id !== null
) || []

const undergroundParkingIds = connections?.filter(c =>
  c.connection_type === 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³' && c.to_block_id === null
).map(c => c.from_block_id) || []
```

### 3. Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ Ð¾Ñ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ð¾Ð¹ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ð¸
**Ð’ `ProjectCardModal.tsx`:**
- Ð”Ð¾Ð±Ð°Ð²Ð»ÐµÐ½ Ð´ÐµÑ‚Ð°Ð»ÑŒÐ½Ñ‹Ð¹ Ð»Ð¾Ð³ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
- ÐžÑ‚Ð»Ð°Ð´ÐºÐ° ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ð¹ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸ Ð´Ð»Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼
- Ð£Ð»ÑƒÑ‡ÑˆÐµÐ½Ð° Ð»Ð¾Ð³Ð¸ÐºÐ° Ð¾Ð±Ñ€Ð°Ð±Ð¾Ñ‚ÐºÐ¸ Ð¿ÑƒÑÑ‚Ñ‹Ñ… ÑÑ‡ÐµÐµÐº

### 4. SQL Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸Ñ Ð´Ð»Ñ Ð±Ð°Ð·Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ…
**Ð¡Ð¾Ð·Ð´Ð°Ð½ Ñ„Ð°Ð¹Ð» `sql/002_update_connection_type_enum.sql`:**
```sql
-- ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ ÑÑƒÑ‰ÐµÑÑ‚Ð²ÑƒÑŽÑ‰Ð¸Ðµ Ð·Ð°Ð¿Ð¸ÑÐ¸
UPDATE public.block_connections_mapping
SET connection_type = 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³'
WHERE connection_type = 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ';

-- ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ enum Ñ‚Ð¸Ð¿, ÑƒÐ±Ð¸Ñ€Ð°Ñ 'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ'
CREATE TYPE public.connection_type_new AS ENUM (
    'Ð¡Ñ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚',
    'ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³'
);
```

## ðŸ”§ **Ð¢ÐµÑ…Ð½Ð¸Ñ‡ÐµÑÐºÐ¸Ðµ Ð´ÐµÑ‚Ð°Ð»Ð¸:**

### Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð² Ð‘Ð”:
```
block_connections_mapping:
- Ð¡Ñ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚: from_block_id â†” to_block_id (ÑÐ²ÑÐ·ÑŒ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸)
- ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³ (Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸): from_block_id â†” to_block_id
- ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³ (Ð¿Ð¾Ð´ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ¾Ð¼): from_block_id, to_block_id = NULL
```

### Ð›Ð¾Ð³Ð¸ÐºÐ° Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ñ Ð² UI:
```typescript
// Ð¡Ñ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚Ñ‹ - Ð´Ð»Ñ Ð¿Ð¾Ð»Ð¾Ð¶Ð¸Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ… ÑÑ‚Ð°Ð¶ÐµÐ¹
if (stylobate && floor > 0 && floor <= stylobate.floors) {
  // ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÐ¼ ÑÑ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚
}
// ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³ - Ð´Ð»Ñ ÑÑ‚Ð°Ð¶Ð° 0 Ð¸ Ð¾Ñ‚Ñ€Ð¸Ñ†Ð°Ñ‚ÐµÐ»ÑŒÐ½Ñ‹Ñ…
else if (connection && floor <= 0) {
  // ÐžÑ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÐ¼ Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ðµ ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸Ðµ
}
```

### ÐžÑ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ:
- Ð›Ð¾Ð³Ð¸ ÑÑ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ñ‹ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ñ€Ð¸ Ð¿Ð¾ÑÑ‚Ñ€Ð¾ÐµÐ½Ð¸Ð¸ Ñ‚Ð°Ð±Ð»Ð¸Ñ†Ñ‹
- Ð”ÐµÑ‚Ð°Ð»ÑŒÐ½Ð°Ñ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸Ñ Ð¾ Ð½Ð°Ð¹Ð´ÐµÐ½Ð½Ñ‹Ñ… ÑÐ¾ÐµÐ´Ð¸Ð½ÐµÐ½Ð¸ÑÑ…
- ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾ÑÑ‚Ð¸ Ð¼Ð°Ð¿Ð¿Ð¸Ð½Ð³Ð° ID ÐºÐ¾Ñ€Ð¿ÑƒÑÐ¾Ð²

## ðŸ§ª **ÐžÐ¶Ð¸Ð´Ð°ÐµÐ¼Ñ‹Ð¹ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚:**
- âœ… Ð¡Ñ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚Ñ‹ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÑŽÑ‚ÑÑ Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸ Ð² ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
- âœ… ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶Ð°ÐµÑ‚ÑÑ Ð¼ÐµÐ¶Ð´Ñƒ ÑÐ²ÑÐ·Ð°Ð½Ð½Ñ‹Ð¼Ð¸ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸
- âœ… Ð£Ð½Ð¸Ñ„Ð¸Ñ†Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð°Ñ Ñ‚ÐµÑ€Ð¼Ð¸Ð½Ð¾Ð»Ð¾Ð³Ð¸Ñ: Ñ‚Ð¾Ð»ÑŒÐºÐ¾ "ÐŸÐ¾Ð´Ð·ÐµÐ¼Ð½Ñ‹Ð¹ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³"
- âœ… ÐšÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾Ðµ Ñ€Ð°Ð·Ð»Ð¸Ñ‡ÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð¾Ð² Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³Ð° (Ð¼ÐµÐ¶Ð´Ñƒ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ°Ð¼Ð¸ / Ð¿Ð¾Ð´ ÐºÐ¾Ñ€Ð¿ÑƒÑÐ¾Ð¼)

## ðŸ“‹ **Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð¿Ð¾ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸ÑŽ:**
1. ÐŸÑ€Ð¸Ð¼ÐµÐ½Ð¸Ñ‚ÑŒ SQL Ð¼Ð¸Ð³Ñ€Ð°Ñ†Ð¸ÑŽ: `psql "$DATABASE_URL" -f sql/002_update_connection_type_enum.sql`
2. ÐŸÑ€Ð¾Ð²ÐµÑ€Ð¸Ñ‚ÑŒ Ð¾Ñ‚Ð¾Ð±Ñ€Ð°Ð¶ÐµÐ½Ð¸Ðµ ÑÑ‚Ð¸Ð»Ð¾Ð±Ð°Ñ‚Ð¾Ð² Ð¸ Ð¿Ð¾Ð´Ð·ÐµÐ¼Ð½Ð¾Ð³Ð¾ Ð¿Ð°Ñ€ÐºÐ¸Ð½Ð³Ð° Ð² ÐºÐ°Ñ€Ñ‚Ð¾Ñ‡ÐºÐµ Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°
3. ÐŸÑ€Ð¸ Ð½ÐµÐ¾Ð±Ñ…Ð¾Ð´Ð¸Ð¼Ð¾ÑÑ‚Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÑŒ Ð¾Ñ‚Ð»Ð°Ð´Ð¾Ñ‡Ð½Ñ‹Ðµ Ð»Ð¾Ð³Ð¸ Ð´Ð»Ñ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸