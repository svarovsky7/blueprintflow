# –û—Ç—á—ë—Ç –æ–± –∞—É–¥–∏—Ç–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ BlueprintFlow

**–î–∞—Ç–∞:** 2025-10-09
**–°—Ç–∞—Ç—É—Å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –û–ë–ù–ê–†–£–ñ–ï–ù–´ –ò –ß–ê–°–¢–ò–ß–ù–û –ò–°–ü–†–ê–í–õ–ï–ù–´

---

## Executive Summary

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å —Ä–æ–ª—å—é "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å" (viewer) –º–æ–≥—É—Ç —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–ø–∏—Å–∏ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö –ø–æ—Ä—Ç–∞–ª–∞, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ `can_view = true, can_create/edit/delete = false`.

### –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ
‚úÖ **–°—Ç—Ä–∞–Ω–∏—Ü–∞ Chessboard** - –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –Ω–∞ –≤—Å–µ –∫–Ω –æ–ø–∫–∏ –∏ inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚úÖ **–°–æ–∑–¥–∞–Ω –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω** - —Ö—É–∫–∏ –∏ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –¥–ª—è –∑–∞—â–∏—Ç—ã UI

### –ß—Ç–æ —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
‚ö†Ô∏è **16 —Å—Ç—Ä–∞–Ω–∏—Ü –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∞–≤**
‚ö†Ô∏è **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç server-side –∑–∞—â–∏—Ç–∞**
‚ö†Ô∏è **–í–æ–∑–º–æ–∂–µ–Ω –æ–±—Ö–æ–¥ —á–µ—Ä–µ–∑ DevTools**

---

## 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1.1. –°—Ç—Ä–∞–Ω–∏—Ü–∞ Chessboard (–ò–°–ü–†–ê–í–õ–ï–ù–û ‚úÖ)

**–§–∞–π–ª—ã:**
- `src/pages/documents/Chessboard/index.tsx`
- `src/pages/documents/Chessboard/components/ChessboardFilters.tsx`
- `src/pages/documents/Chessboard/components/ChessboardActionButtons.tsx`
- `src/pages/documents/Chessboard/components/ChessboardTable.tsx`

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω `usePermissions('chessboard_page')` –≤ –≥–ª–∞–≤–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
2. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å" –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `canCreate === true`
3. ‚úÖ –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å" –≤–∏–¥–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `canDelete === true`
4. ‚úÖ –ü–æ–ª–µ —Å—Ç–∞—Ç—É—Å–æ–≤ (Select) –≤–∏–¥–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `canEdit === true`
5. ‚úÖ –ö–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –∏ "–£–¥–∞–ª–∏—Ç—å" –≤ —Å—Ç—Ä–æ–∫–∞—Ö —Ç–∞–±–ª–∏—Ü—ã —Å–∫—Ä—ã—Ç—ã –±–µ–∑ –ø—Ä–∞–≤
6. ‚úÖ Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ —Å–∫—Ä—ã—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å"
7. ‚úÖ –¶–≤–µ—Ç–æ–≤–∞—è –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫ –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ `canEdit === true`

**–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ —Å –ø—Ä–∞–≤–∞–º–∏ –≤–∏–¥—è—Ç —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –∫–Ω–æ–ø–∫–∏
- TypeScript –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫

### 1.2. –°–æ–∑–¥–∞–Ω –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω (–ù–û–í–û–ï ‚úÖ)

**–ù–æ–≤—ã–µ —Ñ–∞–π–ª—ã:**
- `src/shared/ui/ProtectedButton.tsx` - –∑–∞—â–∏—â–µ–Ω–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –∫–Ω–æ–ø–∫–∏
- `src/shared/hooks/usePagePermissions.ts` - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π —Ö—É–∫ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø—Ä–∞–≤–∞–º–∏

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:**
```tsx
// –í –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
import { usePagePermissions } from '@/shared/hooks/usePagePermissions'

export default function MyPage() {
  const permissions = usePagePermissions('my_page_object_code')

  return (
    <>
      {/* –°–∫—Ä—ã—Ç—å –∫–Ω–æ–ø–∫—É –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤ */}
      {permissions.canCreate && (
        <Button onClick={handleAdd}>–î–æ–±–∞–≤–∏—Ç—å</Button>
      )}

      {/* –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ª—å–∫–æ –Ω–∞ —á—Ç–µ–Ω–∏–µ */}
      {permissions.isReadOnly && (
        <Alert message="–£ –≤–∞—Å —Ç–æ–ª—å–∫–æ –ø—Ä–∞–≤–∞ –Ω–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä" type="info" />
      )}

      {/* Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ */}
      <Table
        editable={permissions.canEdit ? editableConfig : undefined}
        // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–æ–ø—Å—ã
      />
    </>
  )
}
```

---

## 2. –ù–∞–π–¥–µ–Ω–Ω—ã–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏

### 2.1. Client-Side —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (–ö–†–ò–¢–ò–ß–ù–û ‚ö†Ô∏è)

#### 2.1.1. –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∞–≤ –Ω–∞ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞—Ö

**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ (—Ç–æ–ª—å–∫–æ Chessboard)

**–ü—Ä–æ–±–ª–µ–º–∞:**
- 16 –∏–∑ 17 —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ö–Ω–æ–ø–∫–∏ "–î–æ–±–∞–≤–∏—Ç—å", "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å", "–£–¥–∞–ª–∏—Ç—å" –≤–∏–¥–Ω—ã –≤—Å–µ–º
- –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏

**–£—è–∑–≤–∏–º—ã–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã:**

**–î–æ–∫—É–º–µ–Ω—Ç—ã (3/4 —É—è–∑–≤–∏–º—ã):**
- ‚ùå `src/pages/documents/Vor.tsx` (object_code: `vor_page`)
- ‚ùå `src/pages/documents/Documentation.tsx` (object_code: `documentation_page`)
- ‚ùå `src/pages/documents/Finishing.tsx` (object_code: `finishing_page`)
- ‚úÖ `src/pages/documents/Chessboard/index.tsx` - –ò–°–ü–†–ê–í–õ–ï–ù–û

**–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (7/7 —É—è–∑–≤–∏–º—ã):**
- ‚ùå `src/pages/references/Units.tsx` (object_code: `units_page`)
- ‚ùå `src/pages/references/CostCategories.tsx` (object_code: `cost_categories_page`)
- ‚ùå `src/pages/references/Projects.tsx` (object_code: `projects_page`)
- ‚ùå `src/pages/references/Locations.tsx` (object_code: `locations_page`)
- ‚ùå `src/pages/references/Rooms.tsx` (object_code: `rooms_page`)
- ‚ùå `src/pages/references/Rates.tsx` (object_code: `rates_page`)
- ‚ùå `src/pages/references/Nomenclature.tsx` (object_code: `nomenclature_page`)

**–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ (5/5 —É—è–∑–≤–∏–º—ã):**
- ‚ùå `src/pages/administration/Users.tsx` (object_code: `users_page`)
- ‚ùå `src/pages/administration/Roles.tsx` (object_code: `roles_page`)
- ‚ùå `src/pages/administration/DocumentationTags.tsx` (object_code: `tags_page`)
- ‚ùå `src/pages/administration/Statuses.tsx` (object_code: `statuses_page`)
- ‚ùå `src/pages/administration/ApiSettings.tsx` (object_code: `api_settings_page`)

**–°—Ü–µ–Ω–∞—Ä–∏–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å-–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω–∏—Ü—É (–∫—Ä–æ–º–µ Chessboard)
2. –í–∏–¥–∏—Ç –∫–Ω–æ–ø–∫—É "–î–æ–±–∞–≤–∏—Ç—å" –∏ –Ω–∞–∂–∏–º–∞–µ—Ç –µ—ë
3. –û—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å–æ–∑–¥–∞–Ω–∏—è –∑–∞–ø–∏—Å–∏
4. –ó–∞–ø–æ–ª–Ω—è–µ—Ç –ø–æ–ª—è –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç
5. **–ó–∞–ø—Ä–æ—Å —É—Ö–æ–¥–∏—Ç –Ω–∞ —Å–µ—Ä–≤–µ—Ä –ë–ï–ó –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤**

#### 2.1.2. –û–±—Ö–æ–¥ —á–µ—Ä–µ–∑ DevTools (–ö–†–ò–¢–ò–ß–ù–û ‚ö†Ô∏è)

**–°—Ç–∞—Ç—É—Å:** –ù–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç:
1. –û—Ç–∫—Ä—ã—Ç—å DevTools (F12)
2. –ù–∞–π—Ç–∏ —Å–∫—Ä—ã—Ç—ã–π —ç–ª–µ–º–µ–Ω—Ç (–∫–Ω–æ–ø–∫—É) –≤ DOM
3. –£–±—Ä–∞—Ç—å –∞—Ç—Ä–∏–±—É—Ç `hidden` –∏–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —É—Å–ª–æ–≤–∏–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
4. –ù–∞–∂–∞—Ç—å –Ω–∞ –∫–Ω–æ–ø–∫—É –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å

**–°—Ü–µ–Ω–∞—Ä–∏–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏:**
```javascript
// –í –∫–æ–Ω—Å–æ–ª–∏ DevTools
document.querySelector('[data-action="delete"]').click()
// –ò–ª–∏ –Ω–∞–ø—Ä—è–º—É—é –≤—ã–∑–≤–∞—Ç—å API
fetch('https://hfqgcaxmufzitdfafdlp.supabase.co/rest/v1/chessboard', {
  method: 'DELETE',
  headers: { /* ... */ },
  body: JSON.stringify({ id: '123' })
})
```

#### 2.1.3. Direct API calls (–ö–†–ò–¢–ò–ß–ù–û ‚ö†Ô∏è)

**–°—Ç–∞—Ç—É—Å:** –ù–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞–ø—Ä—è–º—É—é –∫ Supabase API, –º–∏–Ω—É—è UI:
```javascript
// –ü—Ä—è–º–æ–π –∑–∞–ø—Ä–æ—Å –∫ Supabase
const { data, error } = await supabase
  .from('chessboard')
  .delete()
  .eq('id', 'some-id')
```

### 2.2. Server-Side —É—è–∑–≤–∏–º–æ—Å—Ç–∏ (–ö–†–ò–¢–ò–ß–ù–û ‚ö†Ô∏è)

#### 2.2.1. Row Level Security (RLS) –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è

**–°—Ç–∞—Ç—É—Å:** –ü–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ RLS –ù–ï –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```sql
-- –ò–∑ supabase/schemas/prod.sql
ALTER TABLE chessboard DISABLE ROW LEVEL SECURITY;
ALTER TABLE users DISABLE ROW LEVEL SECURITY;
-- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∫ –ë–î –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è —á–µ—Ä–µ–∑ `anon key`
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î
- –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±—É—é –æ–ø–µ—Ä–∞—Ü–∏—é

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í–∫–ª—é—á–∏—Ç—å RLS —Å –ø–æ–ª–∏—Ç–∏–∫–∞–º–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ `user_permissions_cache`:
```sql
-- –ü—Ä–∏–º–µ—Ä –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã chessboard
CREATE POLICY "chessboard_select_policy" ON chessboard
  FOR SELECT
  USING (
    EXISTS (
      SELECT 1 FROM user_permissions_cache upc
      WHERE upc.user_id = auth.uid()
        AND upc.object_code = 'chessboard_page'
        AND upc.can_view = true
    )
  );

CREATE POLICY "chessboard_insert_policy" ON chessboard
  FOR INSERT
  WITH CHECK (
    EXISTS (
      SELECT 1 FROM user_permissions_cache upc
      WHERE upc.user_id = auth.uid()
        AND upc.object_code = 'chessboard_page'
        AND upc.can_create = true
    )
  );

-- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è UPDATE –∏ DELETE
```

#### 2.2.2. –û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç RPC —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤

**–°—Ç–∞—Ç—É—Å:** –ù–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö RPC —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ü—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–∞–º –±–µ–∑ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø—Ä–∞–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ–∑–¥–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤:
```sql
-- –ü—Ä–∏–º–µ—Ä RPC —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∑–∞–ø–∏—Å–∏
CREATE OR REPLACE FUNCTION delete_chessboard_row(row_id UUID)
RETURNS void
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  has_permission BOOLEAN;
BEGIN
  -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
  SELECT can_delete INTO has_permission
  FROM user_permissions_cache
  WHERE user_id = auth.uid()
    AND object_code = 'chessboard_page';

  IF NOT has_permission THEN
    RAISE EXCEPTION '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π';
  END IF;

  -- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
  DELETE FROM chessboard WHERE id = row_id;
END;
$$;
```

### 2.3. Auth & Session —É—è–∑–≤–∏–º–æ—Å—Ç–∏

#### 2.3.1. is_active –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –≤—Ö–æ–¥–µ (–°–†–ï–î–ù–ò–ô –†–ò–°–ö ‚ö†Ô∏è)

**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active` –ø—Ä–∏ `signIn()`
- ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ `is_active` –ø—Ä–∏ `checkAuth()`
- ‚ùå –ü—Ä–æ–≤–µ—Ä–∫–∞ –ù–ï –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –∫–∞–∂–¥–æ–º API –∑–∞–ø—Ä–æ—Å–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–∫–ª—é—á–∏—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (`is_active = false`), —Ç–æ:
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∏—Ç —Ä–∞–±–æ—Ç—É –¥–æ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –°–µ—Å—Å–∏—è –≤ Supabase Auth –æ—Å—Ç–∞–µ—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π
- –ú–æ–∂–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ API

**–°—Ü–µ–Ω–∞—Ä–∏–π —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏:**
1. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ª–æ–≥–∏–Ω–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ —Å–∏—Å—Ç–µ–º–µ
2. –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –æ—Ç–∫–ª—é—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
3. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç—É –µ—â—ë 10-30 –º–∏–Ω—É—Ç
4. –¢–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç `checkAuth()` –∏ –≤—ã—Ö–æ–¥

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É `is_active` –≤ RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –∏–ª–∏ –≤ middleware:
```sql
-- –í RLS –ø–æ–ª–∏—Ç–∏–∫–∞—Ö
AND EXISTS (
  SELECT 1 FROM users u
  WHERE u.id = auth.uid() AND u.is_active = true
)
```

#### 2.3.2. –¢–∞–π–º–∞—É—Ç —Å–µ—Å—Å–∏–∏ (–ù–ò–ó–ö–ò–ô –†–ò–°–ö)

**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Supabase Auth –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
- –¢–∞–π–º–∞—É—Ç —Å–µ—Å—Å–∏–∏: 604800 —Å–µ–∫—É–Ω–¥ (7 –¥–Ω–µ–π) - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –¥–ª—è Supabase
- Refresh token: 2592000 —Å–µ–∫—É–Ω–¥ (30 –¥–Ω–µ–π)
- –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞: –≤–∫–ª—é—á–µ–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –î–æ–ª–≥–∏–π —Ç–∞–π–º–∞—É—Ç (7 –¥–Ω–µ–π) –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–∏—Å–∫–æ–º –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç–∞–π–º–∞—É—Ç –¥–æ 8-24 —á–∞—Å–æ–≤ –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
```typescript
// –í src/lib/supabase.ts
export const supabase = createClient(supabaseUrl, supabaseAnonKey, {
  auth: {
    autoRefreshToken: true,
    persistSession: true,
    detectSessionInUrl: true,
    flowType: 'pkce',
    // –°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç–∞–π–º–∞—É—Ç —Å–µ—Å—Å–∏–∏
    storage: {
      getItem: (key) => {
        const item = localStorage.getItem(key)
        if (item) {
          const parsed = JSON.parse(item)
          const expires = parsed.expires_at
          // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ —Å–µ—Å—Å–∏—è –Ω–µ —Å—Ç–∞—Ä—à–µ 8 —á–∞—Å–æ–≤
          if (expires && Date.now() / 1000 > expires - (7 * 24 * 3600) + (8 * 3600)) {
            localStorage.removeItem(key)
            return null
          }
        }
        return item
      },
      setItem: localStorage.setItem,
      removeItem: localStorage.removeItem,
    },
  },
})
```

#### 2.3.3. –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á (–ò–ù–§–û–†–ú–ê–¶–ò–û–ù–ù–û)

**–°—Ç–∞—Ç—É—Å:** –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:**
```typescript
VITE_SUPABASE_ANON_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

**–û—Ü–µ–Ω–∫–∞:**
- ‚úÖ –ê–Ω–æ–Ω–∏–º–Ω—ã–π –∫–ª—é—á –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø—É–±–ª–∏—á–Ω—ã–º (—ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
- ‚úÖ –ó–∞—â–∏—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –Ω–∞ —É—Ä–æ–≤–Ω–µ RLS –ø–æ–ª–∏—Ç–∏–∫, –∞ –Ω–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ—Å—Ç–∏ –∫–ª—é—á–∞
- ‚ö†Ô∏è –ù–û: —Ç–µ–∫—É—â–µ–µ –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ RLS –¥–µ–ª–∞–µ—Ç –ë–î —É—è–∑–≤–∏–º–æ–π

### 2.4. API Security

#### 2.4.1. CORS –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (–ù–ò–ó–ö–ò–ô –†–ò–°–ö)

**–°—Ç–∞—Ç—É—Å:** –ù–µ –ø—Ä–æ–≤–µ—Ä—è–ª–æ—Å—å

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≤ Supabase Dashboard –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ CORS:
- –†–∞–∑—Ä–µ—à–∏—Ç—å —Ç–æ–ª—å–∫–æ –¥–æ–º–µ–Ω—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –ó–∞–ø—Ä–µ—Ç–∏—Ç—å `*` (wildcard)

#### 2.4.2. Rate Limiting (–°–†–ï–î–ù–ò–ô –†–ò–°–ö ‚ö†Ô∏è)

**–°—Ç–∞—Ç—É—Å:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π Rate Limiting –æ—Ç Supabase

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –Ω–∞ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —Å—Ç–æ—Ä–æ–Ω–µ
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –º–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–æ–≤ –∑–∞ –∫–æ—Ä–æ—Ç–∫–æ–µ –≤—Ä–µ–º—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å debounce/throttle –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
```typescript
import { debounce } from 'lodash'

const debouncedSave = debounce(async (data) => {
  await supabase.from('chessboard').insert(data)
}, 1000)
```

---

## 3. –®–∞–±–ª–æ–Ω—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### 3.1. –®–∞–±–ª–æ–Ω –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏

**–î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –≤:**
- Vor.tsx
- Documentation.tsx
- Finishing.tsx
- Units.tsx, CostCategories.tsx, Projects.tsx, Locations.tsx, Rooms.tsx, Rates.tsx, Nomenclature.tsx

**–®–∞–≥ 1:** –î–æ–±–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç —Ö—É–∫–∞

```typescript
// –í –Ω–∞—á–∞–ª–æ —Ñ–∞–π–ª–∞
import { usePagePermissions } from '@/shared/hooks/usePagePermissions'
```

**–®–∞–≥ 2:** –î–æ–±–∞–≤–∏—Ç—å —Ö—É–∫ –≤ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç

```typescript
export default function MyPage() {
  // –î—Ä—É–≥–∏–µ —Ö—É–∫–∏...
  const permissions = usePagePermissions('my_page_object_code') // –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π object_code

  // –û—Å—Ç–∞–ª—å–Ω–æ–π –∫–æ–¥...
}
```

**–®–∞–≥ 3:** –û–±–µ—Ä–Ω—É—Ç—å –∫–Ω–æ–ø–∫–∏ –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏

```typescript
// –ö–Ω–æ–ø–∫–∞ "–î–æ–±–∞–≤–∏—Ç—å"
{permissions.canCreate && (
  <Button type="primary" icon={<PlusOutlined />} onClick={handleAdd}>
    –î–æ–±–∞–≤–∏—Ç—å
  </Button>
)}

// –ö–Ω–æ–ø–∫–∞ "–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å" –≤ —Å—Ç—Ä–æ–∫–µ —Ç–∞–±–ª–∏—Ü—ã
{permissions.canEdit && (
  <Button
    type="text"
    icon={<EditOutlined />}
    onClick={() => handleEdit(record)}
  />
)}

// –ö–Ω–æ–ø–∫–∞ "–£–¥–∞–ª–∏—Ç—å"
{permissions.canDelete && (
  <Button
    type="text"
    danger
    icon={<DeleteOutlined />}
    onClick={() => handleDelete(record.id)}
  />
)}

// –ö–Ω–æ–ø–∫–∞ –∏–º–ø–æ—Ä—Ç–∞
{permissions.canCreate && (
  <Button icon={<UploadOutlined />} onClick={handleImport}>
    –ò–º–ø–æ—Ä—Ç
  </Button>
)}

// –ö–Ω–æ–ø–∫–∞ —ç–∫—Å–ø–æ—Ä—Ç–∞ (–¥–æ—Å—Ç—É–ø–Ω–∞ –≤—Å–µ–≥–¥–∞ –µ—Å–ª–∏ –µ—Å—Ç—å can_view)
{permissions.canExport && (
  <Button icon={<DownloadOutlined />} onClick={handleExport}>
    –≠–∫—Å–ø–æ—Ä—Ç
  </Button>
)}
```

**–®–∞–≥ 4:** –û—Ç–∫–ª—é—á–∏—Ç—å inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

```typescript
// –î–ª—è Ant Design Table —Å editableRows
const columns: ColumnsType<DataType> = useMemo(() => {
  return baseColumns.map(col => {
    // –û—Ç–∫–ª—é—á–∏—Ç—å —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –µ—Å–ª–∏ –Ω–µ—Ç –ø—Ä–∞–≤
    if (col.editable && !permissions.canEdit) {
      return { ...col, editable: false }
    }
    return col
  })
}, [baseColumns, permissions.canEdit])
```

### 3.2. –ú–∞–ø–ø–∏–Ω–≥ object_code –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü

```typescript
// –î–æ–∫—É–º–µ–Ω—Ç—ã
'chessboard_page'      ‚Üí src/pages/documents/Chessboard/index.tsx ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û
'vor_page'             ‚Üí src/pages/documents/Vor.tsx ‚ùå
'documentation_page'   ‚Üí src/pages/documents/Documentation.tsx ‚ùå
'finishing_page'       ‚Üí src/pages/documents/Finishing.tsx ‚ùå

// –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏
'units_page'           ‚Üí src/pages/references/Units.tsx ‚ùå
'cost_categories_page' ‚Üí src/pages/references/CostCategories.tsx ‚ùå
'projects_page'        ‚Üí src/pages/references/Projects.tsx ‚ùå
'locations_page'       ‚Üí src/pages/references/Locations.tsx ‚ùå
'rooms_page'           ‚Üí src/pages/references/Rooms.tsx ‚ùå
'rates_page'           ‚Üí src/pages/references/Rates.tsx ‚ùå
'nomenclature_page'    ‚Üí src/pages/references/Nomenclature.tsx ‚ùå

// –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ
'users_page'           ‚Üí src/pages/administration/Users.tsx ‚ùå
'roles_page'           ‚Üí src/pages/administration/Roles.tsx ‚ùå
'tags_page'            ‚Üí src/pages/administration/DocumentationTags.tsx ‚ùå
'statuses_page'        ‚Üí src/pages/administration/Statuses.tsx ‚ùå
'api_settings_page'    ‚Üí src/pages/administration/ApiSettings.tsx ‚ùå
```

### 3.3. –°–æ–∑–¥–∞–Ω–∏–µ RPC —Ñ—É–Ω–∫—Ü–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–§–∞–π–ª:** `sql/create_secure_rpc_functions.sql`

```sql
-- =====================================================
-- RPC –§–£–ù–ö–¶–ò–ò –° –ü–†–û–í–ï–†–ö–û–ô –ü–†–ê–í
-- =====================================================

-- 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
CREATE OR REPLACE FUNCTION check_user_permission(
  p_object_code TEXT,
  p_action TEXT -- 'view', 'create', 'edit', 'delete'
)
RETURNS BOOLEAN
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  has_permission BOOLEAN := FALSE;
BEGIN
  -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  IF auth.uid() IS NULL THEN
    RETURN FALSE;
  END IF;

  -- –ü—Ä–æ–≤–µ—Ä–∫–∞ is_active
  IF NOT EXISTS (SELECT 1 FROM users WHERE id = auth.uid() AND is_active = TRUE) THEN
    RETURN FALSE;
  END IF;

  -- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
  EXECUTE format('SELECT can_%s FROM user_permissions_cache WHERE user_id = $1 AND object_code = $2', p_action)
  INTO has_permission
  USING auth.uid(), p_object_code;

  RETURN COALESCE(has_permission, FALSE);
END;
$$;

-- 2. –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ chessboard
CREATE OR REPLACE FUNCTION secure_delete_chessboard(p_row_id UUID)
RETURNS void
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
BEGIN
  IF NOT check_user_permission('chessboard_page', 'delete') THEN
    RAISE EXCEPTION '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ —à–∞—Ö–º–∞—Ç–∫–µ';
  END IF;

  DELETE FROM chessboard WHERE id = p_row_id;
END;
$$;

-- 3. –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ chessboard
CREATE OR REPLACE FUNCTION secure_insert_chessboard(p_data JSONB)
RETURNS UUID
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
DECLARE
  new_id UUID;
BEGIN
  IF NOT check_user_permission('chessboard_page', 'create') THEN
    RAISE EXCEPTION '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ —à–∞—Ö–º–∞—Ç–∫–µ';
  END IF;

  INSERT INTO chessboard (
    project_id,
    material,
    quantity_pd,
    unit_id
    -- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  )
  SELECT
    (p_data->>'project_id')::UUID,
    p_data->>'material',
    (p_data->>'quantity_pd')::NUMERIC,
    (p_data->>'unit_id')::UUID
    -- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  RETURNING id INTO new_id;

  RETURN new_id;
END;
$$;

-- 4. –ó–∞—â–∏—â–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–∏ chessboard
CREATE OR REPLACE FUNCTION secure_update_chessboard(p_row_id UUID, p_data JSONB)
RETURNS void
LANGUAGE plpgsql
SECURITY DEFINER
AS $$
BEGIN
  IF NOT check_user_permission('chessboard_page', 'edit') THEN
    RAISE EXCEPTION '–£ –≤–∞—Å –Ω–µ—Ç –ø—Ä–∞–≤ –Ω–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ —à–∞—Ö–º–∞—Ç–∫–µ';
  END IF;

  UPDATE chessboard
  SET
    material = COALESCE(p_data->>'material', material),
    quantity_pd = COALESCE((p_data->>'quantity_pd')::NUMERIC, quantity_pd),
    unit_id = COALESCE((p_data->>'unit_id')::UUID, unit_id),
    updated_at = NOW()
    -- ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–æ–ª—è
  WHERE id = p_row_id;
END;
$$;
```

**–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ API:**

```typescript
// src/entities/chessboard/api/chessboard-api.ts

// –°–¢–ê–†–´–ô –ö–û–î (–ë–ï–ó –ó–ê–©–ò–¢–´):
export async function deleteChessboardRow(id: string) {
  const { error } = await supabase
    .from('chessboard')
    .delete()
    .eq('id', id)

  if (error) throw error
}

// –ù–û–í–´–ô –ö–û–î (–° –ó–ê–©–ò–¢–û–ô):
export async function deleteChessboardRow(id: string) {
  const { error } = await supabase
    .rpc('secure_delete_chessboard', { p_row_id: id })

  if (error) {
    // –û—à–∏–±–∫–∞ –ø—Ä–∞–≤ –≤—ã–≤–æ–¥–∏—Ç—Å—è –∫–∞–∫ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –∏–∑ RPC
    throw new Error(error.message)
  }
}
```

---

## 4. –ü—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –ù–ï–ú–ï–î–õ–ï–ù–ù–û) üî¥

1. **–í–∫–ª—é—á–∏—Ç—å RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö** - 2-4 —á–∞—Å–∞
   - –ù–∞–ø–∏—Å–∞—Ç—å –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ dev –æ–∫—Ä—É–∂–µ–Ω–∏–∏
   - –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–∞ production

2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏** - 8-12 —á–∞—Å–æ–≤
   - 16 —Å—Ç—Ä–∞–Ω–∏—Ü √ó 30 –º–∏–Ω—É—Ç = 8 —á–∞—Å–æ–≤
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω –∏–∑ —Ä–∞–∑–¥–µ–ª–∞ 3.1

3. **–°–æ–∑–¥–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π** - 4-6 —á–∞—Å–æ–≤
   - DELETE –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–ª—è –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü
   - INSERT/UPDATE –¥–ª—è chessboard, vor, documentation, finishing
   - –û–±–Ω–æ–≤–∏—Ç—å API –∫–ª–∏–µ–Ω—Ç—ã

### –í—ã—Å–æ–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1-2 –Ω–µ–¥–µ–ª–∏) üü†

4. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É is_active –≤ RLS –ø–æ–ª–∏—Ç–∏–∫–∏** - 1 —á–∞—Å
   - –û–±–Ω–æ–≤–∏—Ç—å –≤—Å–µ –ø–æ–ª–∏—Ç–∏–∫–∏
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

5. **–î–æ–±–∞–≤–∏—Ç—å Rate Limiting –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ** - 2-3 —á–∞—Å–∞
   - Debounce –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
   - Throttle –¥–ª—è –ø–æ–∏—Å–∫–∞/—Ñ–∏–ª—å—Ç—Ä–æ–≤

6. **–ê—É–¥–∏—Ç CORS –∏ API –Ω–∞—Å—Ç—Ä–æ–µ–∫** - 1 —á–∞—Å
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Supabase Dashboard
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–µ –¥–æ–º–µ–Ω—ã

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (1 –º–µ—Å—è—Ü) üü°

7. **–°–æ–∫—Ä–∞—Ç–∏—Ç—å —Ç–∞–π–º–∞—É—Ç —Å–µ—Å—Å–∏–∏ –¥–æ 8-24 —á–∞—Å–æ–≤** - 2 —á–∞—Å–∞
   - –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ Supabase Auth
   - –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤

8. **–î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–µ–π—Å—Ç–≤–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** - 4-6 —á–∞—Å–æ–≤
   - –°–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É audit_log
   - –¢—Ä–∏–≥–≥–µ—Ä—ã –Ω–∞ INSERT/UPDATE/DELETE
   - UI –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤

### –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (backlog) üü¢

9. **–î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è (2FA)** - 8-12 —á–∞—Å–æ–≤
   - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è Supabase MFA
   - UI –¥–ª—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ 2FA

10. **Webhook —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏—è—Ö** - 4-6 —á–∞—Å–æ–≤
    - –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - –ú–∞—Å—Å–æ–≤–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
    - –ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞

---

## 5. –°—Ç–∞—Ç—É—Å —Å—Ç—Ä–∞–Ω–∏—Ü (—Å–≤–æ–¥–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)

| –°—Ç—Ä–∞–Ω–∏—Ü–∞ | Object Code | View | Create | Edit | Delete | –°—Ç–∞—Ç—É—Å |
|----------|-------------|------|--------|------|--------|--------|
| **–î–æ–∫—É–º–µ–Ω—Ç—ã** |||||
| Chessboard | `chessboard_page` | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û |
| –í–û–† | `vor_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è | `documentation_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –û—Ç–¥–µ–ª–∫–∞ | `finishing_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| **–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏** |||||
| –ï–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è | `units_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∑–∞—Ç—Ä–∞—Ç | `cost_categories_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –ü—Ä–æ–µ–∫—Ç—ã | `projects_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è | `locations_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –ü–æ–º–µ—â–µ–Ω–∏—è | `rooms_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –†–∞—Å—Ü–µ–Ω–∫–∏ | `rates_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –ù–æ–º–µ–Ω–∫–ª–∞—Ç—É—Ä–∞ | `nomenclature_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| **–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ** |||||
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ | `users_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –†–æ–ª–∏ | `roles_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –¢–µ–≥–∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | `tags_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –°—Ç–∞—Ç—É—Å—ã | `statuses_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |
| –ù–∞—Å—Ç—Ä–æ–π–∫–∏ API | `api_settings_page` | ‚ùå | ‚ùå | ‚ùå | ‚ùå | ‚ö†Ô∏è –£–Ø–ó–í–ò–ú–û |

**–õ–µ–≥–µ–Ω–¥–∞:**
- ‚úÖ = –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚ùå = –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç
- ‚ö†Ô∏è = –£—è–∑–≤–∏–º–æ

**–ò—Ç–æ–≥–æ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: 1 –∏–∑ 16 —Å—Ç—Ä–∞–Ω–∏—Ü (6%)
- ‚ö†Ô∏è –£—è–∑–≤–∏–º–æ: 15 –∏–∑ 16 —Å—Ç—Ä–∞–Ω–∏—Ü (94%)

---

## 6. –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 6.1. –ù–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è

1. **–í–∫–ª—é—á–∏—Ç—å RLS –Ω–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö** - —ç—Ç–æ –ö–†–ò–¢–ò–ß–ù–û
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–∞–≤ –Ω–∞ –≤—Å–µ—Ö —Å—Ç—Ä–∞–Ω–∏—Ü–∞—Ö** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —à–∞–±–ª–æ–Ω
3. **–°–æ–∑–¥–∞—Ç—å RPC —Ñ—É–Ω–∫—Ü–∏–∏** - –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç –ø—Ä—è–º—ã—Ö API –≤—ã–∑–æ–≤–æ–≤

### 6.2. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **–ü—Ä–∏–Ω—Ü–∏–ø Zero Trust**
   - –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –¥–æ–≤–µ—Ä—è—Ç—å –∫–ª–∏–µ–Ω—Ç—É
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø—Ä–∞–≤–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
   - UI –ø—Ä–æ–≤–µ—Ä–∫–∏ - —Ç–æ–ª—å–∫–æ –¥–ª—è UX, –Ω–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

2. **Defense in Depth (—ç—à–µ–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∑–∞—â–∏—Ç–∞)**
   - –£—Ä–æ–≤–µ–Ω—å 1: UI –ø—Ä–æ–≤–µ—Ä–∫–∏ (UX) ‚úÖ –†–ï–ê–õ–ò–ó–û–í–ê–ù–û
   - –£—Ä–æ–≤–µ–Ω—å 2: RPC —Ñ—É–Ω–∫—Ü–∏–∏ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤ ‚ùå –¢–†–ï–ë–£–ï–¢–°–Ø
   - –£—Ä–æ–≤–µ–Ω—å 3: RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –Ω–∞ —Ç–∞–±–ª–∏—Ü–∞—Ö ‚ùå –¢–†–ï–ë–£–ï–¢–°–Ø
   - –£—Ä–æ–≤–µ–Ω—å 4: Audit logging ‚ùå –¢–†–ï–ë–£–ï–¢–°–Ø

3. **–ü—Ä–∏–Ω—Ü–∏–ø –º–∏–Ω–∏–º–∞–ª—å–Ω—ã—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π**
   - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ù–ï–¢ –ø—Ä–∞–≤
   - –ü—Ä–∞–≤–∞ –≤—ã–¥–∞—é—Ç—Å—è —è–≤–Ω–æ —á–µ—Ä–µ–∑ —Ä–æ–ª–∏
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –ö–ê–ñ–î–û–ú –∑–∞–ø—Ä–æ—Å–µ

### 6.3. –ü—Ä–æ—Ü–µ—Å—Å—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

1. **Security Checklist –¥–ª—è –Ω–æ–≤—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü**
   ```
   ‚ñ° –î–æ–±–∞–≤–ª–µ–Ω usePagePermissions() —Ö—É–∫
   ‚ñ° –ö–Ω–æ–ø–∫–∏ –æ–±–µ—Ä–Ω—É—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ {canCreate && ...}
   ‚ñ° Inline-—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Ç–∫–ª—é—á–µ–Ω–æ –±–µ–∑ –ø—Ä–∞–≤
   ‚ñ° API —Ñ—É–Ω–∫—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç RPC —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
   ‚ñ° –î–æ–±–∞–≤–ª–µ–Ω—ã RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü
   ‚ñ° –ü—Ä–æ–≤–µ–¥–µ–Ω–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ä–æ–ª—å—é "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å"
   ```

2. **Code Review Guidelines**
   - –ü—Ä–æ–≤–µ—Ä—è—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∞–≤ –≤ –∫–∞–∂–¥–æ–º PR
   - –ó–∞–ø—Ä–µ—â–∞—Ç—å –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–∞–º –±–µ–∑ RPC
   - –¢—Ä–µ–±–æ–≤–∞—Ç—å RLS –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü

3. **Testing**
   - –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è-–Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—è
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ö–ê–ñ–î–£–Æ —Å—Ç—Ä–∞–Ω–∏—Ü—É —Å —ç—Ç–æ–π —Ä–æ–ª—å—é
   - –ê–≤—Ç–æ—Ç–µ—Å—Ç—ã –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –ø—Ä–∞–≤ (Playwright)

---

## 7. –ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤

**–ê—É–¥–∏—Ç–æ—Ä:** Claude (AI Assistant)
**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 2025-10-09
**–í–µ—Ä—Å–∏—è –æ—Ç—á—ë—Ç–∞:** 1.0

**–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:**
1. –†–∞—Å—Å–º–æ—Ç—Ä–µ—Ç—å –æ—Ç—á—ë—Ç –Ω–∞ –≤—Å—Ç—Ä–µ—á–µ –∫–æ–º–∞–Ω–¥—ã
2. –ù–∞–∑–Ω–∞—á–∏—Ç—å –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã—Ö –∑–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –¥–µ–¥–ª–∞–π–Ω—ã (–ø—Ä–µ–¥–ª–æ–∂–µ–Ω–æ –≤—ã—à–µ –≤ —Ä–∞–∑–¥–µ–ª–µ 4)
4. –ü—Ä–æ–≤–µ—Å—Ç–∏ –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∞—É–¥–∏—Ç –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π

---

## –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ A: –ü—Ä–∏–º–µ—Ä—ã –∞—Ç–∞–∫

### A.1. –°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏ "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø–∏—Å–µ–π"

**–ê–∫—Ç–æ—Ä:** –ù–µ–¥–æ–±—Ä–æ—Å–æ–≤–µ—Å—Ç–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å —Ä–æ–ª—å—é "–ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å"

**–®–∞–≥–∏:**
1. –û—Ç–∫—Ä—ã—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É Vor.tsx (–í–û–†)
2. –û—Ç–∫—Ä—ã—Ç—å DevTools (F12)
3. –í—ã–ø–æ–ª–Ω–∏—Ç—å –≤ –∫–æ–Ω—Å–æ–ª–∏:
```javascript
const { data } = await supabase.from('vor').select('id')
for (const row of data) {
  await supabase.from('vor').delete().eq('id', row.id)
}
```
4. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –í—Å–µ –∑–∞–ø–∏—Å–∏ —É–¥–∞–ª–µ–Ω—ã, –ø—Ä–∞–≤–∞ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏—Å—å

**–ó–∞—â–∏—Ç–∞:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∞ –Ω–∞ DELETE
- RPC —Ñ—É–Ω–∫—Ü–∏—è —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤
- Audit log –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

### A.2. –°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏ "–ò–∑–º–µ–Ω–µ–Ω–∏–µ —á—É–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö"

**–ê–∫—Ç–æ—Ä:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ —Å–≤–æ–π –ø—Ä–æ–µ–∫—Ç

**–®–∞–≥–∏:**
1. –ù–∞–π—Ç–∏ ID –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ (—á–µ—Ä–µ–∑ API –∏–ª–∏ UI)
2. –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å:
```javascript
await supabase
  .from('chessboard')
  .update({ material: '–í–†–ï–î–û–ù–û–°–ù–´–ï –î–ê–ù–ù–´–ï' })
  .eq('project_id', '–¥—Ä—É–≥–æ–π-–ø—Ä–æ–µ–∫—Ç-id')
```
3. **–†–µ–∑—É–ª—å—Ç–∞—Ç:** –î–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω—ã

**–ó–∞—â–∏—Ç–∞:**
- RLS –ø–æ–ª–∏—Ç–∏–∫–∞ —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π project_id –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- RPC —Ñ—É–Ω–∫—Ü–∏—è —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –ø—Ä–æ–µ–∫—Ç—É

---

**–ö–û–ù–ï–¶ –û–¢–ß–Å–¢–ê**
